<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AgroSphere - Leaf Disease Analyzer</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        'poppins': ['Poppins', 'sans-serif'],
                    },
                    colors: {
                        'primary': '#22c55e',
                        'primary-dark': '#16a34a',
                        'dark-bg': '#0f172a',
                        'light-bg': '#f1f5f9',
                        'text-dark': '#0f172a',
                        'card-bg': '#1e293b',
                        'border-color': 'rgba(255, 255, 255, 0.1)',
                    }
                }
            }
        }
    </script>
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: #0b1120;
        }
        .main-container::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 800px;
            height: 800px;
            background-image: radial-gradient(circle, rgba(34, 197, 94, 0.1), transparent 60%);
            transform: translate(-50%, -50%);
            filter: blur(100px);
            z-index: 0;
            pointer-events: none;
        }
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: .5; }
        }
        .typing-dot {
            animation: pulse 1.4s infinite;
        }
        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }
        .result-content h3 {
            font-size: 1.25rem;
            font-weight: 600;
            color: #22c55e; /* primary */
            margin-bottom: 0.5rem;
        }
        .result-content p {
            margin-bottom: 1rem;
            color: #cbd5e1; /* slate-300 */
        }
        .result-content ul {
            list-style-type: disc;
            margin-left: 1.5rem;
            margin-bottom: 1rem;
            color: #cbd5e1;
        }
         .result-content strong {
            color: white;
            font-weight: 600;
        }
    </style>
</head>
<body class="bg-dark-bg text-slate-300 flex items-center justify-center min-h-screen p-4">

    <div class="w-full max-w-6xl mx-auto bg-dark-bg/80 backdrop-blur-sm rounded-2xl shadow-2xl shadow-black/30 overflow-hidden relative main-container border border-border-color">
        <main class="text-white p-6 md:p-8 relative z-10">

            <header class="flex items-center space-x-3 mb-8">
                <svg width="40" height="40" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M12 2C6.48 2 2 6.48 2 12C2 17.52 6.48 22 12 22C17.52 22 22 17.52 22 12C22 6.48 17.52 2 12 2ZM12 20C7.59 20 4 16.41 4 12C4 7.59 7.59 4 12 4C16.41 4 20 7.59 20 12C20 16.41 16.41 20 12 20Z" fill="#16a34a"/>
                    <path d="M12 6C9.17 6 6.84 7.63 5.5 10.04C6.87 8.5 8.83 7.5 11 7.5V10.5L14.5 7L11 3.5V6.5C10.5 6.5 10 6.5 9.5 6.5C8.81 6.5 8.16 6.62 7.55 6.81C8.83 5.67 10.41 5 12 5C13.59 5 15.17 5.67 16.45 6.81C17.16 6.62 17.81 6.5 18.5 6.5C19 6.5 19.5 6.5 20 6.5V3.5L16.5 7L20 10.5V7.5C18.17 7.5 16.13 8.5 14.5 10.04C13.16 7.63 10.83 6 12 6Z" fill="#22c55e"/>
                </svg>
                <h1 class="text-3xl font-bold tracking-wider">AgroSphere Leaf Analyzer</h1>
            </header>

            <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                <!-- Image Upload Panel -->
                <div class="space-y-4">
                    <div id="image-upload-box" class="relative w-full aspect-video bg-card-bg/50 border-2 border-dashed border-slate-600 rounded-xl flex flex-col justify-center items-center text-center p-6 cursor-pointer hover:border-primary transition-colors">
                        <div id="upload-prompt">
                            <svg class="mx-auto h-12 w-12 text-slate-500" viewBox="0 0 24 24" fill="currentColor"><path d="M19.35 10.04C18.67 6.59 15.64 4 12 4 9.11 4 6.6 5.64 5.35 8.04 2.34 8.36 0 10.91 0 14c0 3.31 2.69 6 6 6h13c2.76 0 5-2.24 5-5 0-2.64-2.05-4.78-4.65-4.96zM14 13v4h-4v-4H7l5-5 5 5h-3z"/></svg>
                            <h3 class="mt-2 text-sm font-medium text-white">Drop a leaf image here</h3>
                            <p class="mt-1 text-xs text-slate-400">or click to select a file</p>
                        </div>
                        <img id="image-preview" src="" class="hidden absolute inset-0 w-full h-full object-contain rounded-xl p-2"/>
                        <input id="file-input" type="file" class="sr-only" accept="image/*">
                    </div>
                     <button id="analyze-button" class="w-full bg-primary text-white font-bold py-3 px-4 rounded-lg hover:bg-primary-dark transition-colors disabled:bg-slate-600 disabled:cursor-not-allowed" disabled>Analyze Leaf</button>
                </div>

                <!-- AI Chat/Result Panel -->
                <div class="bg-card-bg/80 rounded-xl border border-border-color p-6 flex flex-col min-h-[400px]">
                    <h2 class="text-xl font-semibold mb-4 text-slate-200">AI Analysis</h2>
                    <div id="result-box" class="flex-grow overflow-y-auto pr-2">
                         <div id="initial-message" class="flex items-start space-x-3">
                            <div class="w-10 h-10 bg-dark-bg rounded-full flex items-center justify-center flex-shrink-0">
                                <svg class="w-6 h-6 text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                            </div>
                            <div class="bg-dark-bg p-4 rounded-lg">
                                <p>Welcome to the AgroSphere Leaf Analyzer. Please upload an image of a plant leaf, and I will identify potential diseases and suggest remedies.</p>
                            </div>
                        </div>
                         <div id="loading-indicator" class="hidden flex items-start space-x-3">
                             <div class="w-10 h-10 bg-dark-bg rounded-full flex items-center justify-center flex-shrink-0">
                                 <svg class="w-6 h-6 text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                            </div>
                            <div class="bg-dark-bg p-4 rounded-lg flex items-center space-x-2">
                                <p>Analyzing image</p>
                                <div class="typing-dot h-2 w-2 bg-slate-400 rounded-full"></div>
                                <div class="typing-dot h-2 w-2 bg-slate-400 rounded-full"></div>
                                <div class="typing-dot h-2 w-2 bg-slate-400 rounded-full"></div>
                            </div>
                        </div>
                        <div id="result-content"></div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const uploadBox = document.getElementById('image-upload-box');
            const fileInput = document.getElementById('file-input');
            const imagePreview = document.getElementById('image-preview');
            const uploadPrompt = document.getElementById('upload-prompt');
            const analyzeButton = document.getElementById('analyze-button');
            const resultBox = document.getElementById('result-box');
            const initialMessage = document.getElementById('initial-message');
            const loadingIndicator = document.getElementById('loading-indicator');
            const resultContent = document.getElementById('result-content');

            let uploadedFile = null;

            // --- Event Listeners for Upload Box ---
            uploadBox.addEventListener('click', () => fileInput.click());
            uploadBox.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadBox.classList.add('border-primary', 'bg-primary/10');
            });
            uploadBox.addEventListener('dragleave', () => {
                uploadBox.classList.remove('border-primary', 'bg-primary/10');
            });
            uploadBox.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadBox.classList.remove('border-primary', 'bg-primary/10');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
            fileInput.addEventListener('change', (e) => {
                if (e.target.files.length > 0) {
                    handleFile(e.target.files[0]);
                }
            });
            
            analyzeButton.addEventListener('click', analyzeImage);

            function handleFile(file) {
                if (file && file.type.startsWith('image/')) {
                    uploadedFile = file;
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        imagePreview.src = e.target.result;
                        imagePreview.classList.remove('hidden');
                        uploadPrompt.classList.add('hidden');
                        analyzeButton.disabled = false;
                    }
                    reader.readAsDataURL(file);
                } else {
                    alert('Please select a valid image file.');
                }
            }
            
            function toBase64(file) {
                return new Promise((resolve, reject) => {
                    const reader = new FileReader();
                    reader.readAsDataURL(file);
                    reader.onload = () => resolve(reader.result.split(',')[1]);
                    reader.onerror = error => reject(error);
                });
            }

            async function analyzeImage() {
                if (!uploadedFile) return;

                initialMessage.classList.add('hidden');
                resultContent.innerHTML = '';
                loadingIndicator.classList.remove('hidden');
                analyzeButton.disabled = true;

                try {
                    const base64ImageData = await toBase64(uploadedFile);
                    const prompt = `You are an expert agronomist called "AgroSphere AI". Analyze the provided image of a plant leaf. 
                    Identify the plant and any visible diseases. Provide a confident and clear analysis. 
                    Your response must be structured in markdown with the following sections:
                    - ### Disease Identification: [Name of the disease]
                    - ### Confidence Level: [e.g., High, Medium, Low]
                    - ### Description: [A brief, professional paragraph about the disease, its symptoms, and causes.]
                    - ### Management & Cures: [A bulleted list of actionable steps, including both organic and chemical treatments if applicable.]
                    
                    If the image is not a plant leaf or no disease is visible, state that clearly and professionally.`;

                    const apiKey = "AIzaSyAICgNvyUUe4ikL5GG3P_2D9LFvY7m0oSg"; 
                    const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=${apiKey}`;

                    const payload = {
                        contents: [{
                            parts: [
                                { text: prompt },
                                { inlineData: { mimeType: uploadedFile.type, data: base64ImageData } }
                            ]
                        }]
                    };

                    const response = await fetch(apiUrl, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(payload)
                    });

                    if (!response.ok) {
                        throw new Error(`API error: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    const analysisText = result.candidates[0].content.parts[0].text;
                    
                    displayResults(analysisText);

                } catch (error) {
                    console.error("Analysis Error:", error);
                    displayResults("<p><strong>Analysis Failed:</strong> Could not get a response from the AI. Please check your connection and try again.</p>");
                } finally {
                    loadingIndicator.classList.add('hidden');
                    analyzeButton.disabled = false;
                }
            }

            function displayResults(markdownText) {
                 // A simple markdown to HTML converter
                let html = markdownText
                    .replace(/### (.*)/g, '<h3>$1</h3>')
                    .replace(/\* \s*(.*)/g, '<li>$1</li>')
                    .replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>');
                
                // Wrap list items in <ul>
                if(html.includes('<li>')) {
                    html = html.replace(/<li>/, '<ul><li>') + '</ul>';
                }

                resultContent.innerHTML = `
                    <div class="flex items-start space-x-3">
                        <div class="w-10 h-10 bg-dark-bg rounded-full flex items-center justify-center flex-shrink-0">
                            <svg class="w-6 h-6 text-primary" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="currentColor"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm-2 16l-4-4 1.41-1.41L10 14.17l6.59-6.59L18 9l-8 8z"/></svg>
                        </div>
                        <div class="bg-dark-bg p-4 rounded-lg">${html}</div>
                    </div>
                `;
            }
        });
    </script>
</body>
</html>